<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Explorar por proveedor</title>
    <link rel="stylesheet" th:href="@{/css/ver-proveedores.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">
  <div th:replace="fragments/header :: header"></div>

    <div class="container py-5">
        <h1 class="text-center mb-4">Explorar por Proveedor</h1>
        <p class="text-center text-muted mb-4">
            Seleccioná el tipo de producto que querés ver, y descubrí los proveedores disponibles.
        </p>

        <!-- Filtros -->
        <div class="d-flex justify-content-center flex-wrap gap-2 mb-4">
            <button id="btnTodos" class="btn btn-primary filtro-btn me-2">
                <i class="bi bi-grid"></i> Todos
            </button>

            <button th:each="rubro : ${rubros}" class="btn btn-outline-primary filtro-btn" th:data-rubro="${rubro}">
                <i th:classappend="${rubro.icono}"></i>
                <span th:text="${rubro.descripcion}"></span>
            </button>
        </div>
        <!-- Loader animado -->
        <div id="loader" class="text-center my-4" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
        </div>

        <!-- Grid de proveedores -->
        <div class="row g-4" id="proveedoresGrid">
            <div class="col-6 col-md-4 col-lg-3 text-center" th:each="proveedor : ${proveedores}"
                th:data-tipo="${proveedor.rubro}">
                <a th:href="@{/catalogo/{id}(id=${proveedor.id})}">
                    <div class="h-100 proveedor-card p-3">
                        <img th:src="@{${proveedor.logoPath}}" class="img-fluid mx-auto d-block logo-img"
                            alt="Logo del proveedor">
                        <!--<h6 class="mt-3" th:text="${proveedor.razonSocial}"></h6>-->
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div th:replace="fragments/footer :: footer-comun"></div>

    <script>
        // el botón "Todos"
        const btnTodos = document.getElementById('btnTodos');
        if (btnTodos) {
            btnTodos.addEventListener('click', () => {
                // Mostrar loader
                const loader = document.getElementById('loader');
                const contenedor = document.getElementById('proveedoresGrid');
                loader.style.display = 'block';
                contenedor.innerHTML = '';

                // Redirigir a la página que muestra todos
                window.location.href = '/spring/ver-proveedores';
            });
        }

        //filtro con ajax y json
        document.querySelectorAll('.filtro-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const rubro = this.dataset.rubro;
                const contenedor = document.getElementById('proveedoresGrid');
                const loader = document.getElementById('loader');

                // Mostrar loader y ocultar contenido
                contenedor.classList.remove('show');
                loader.style.display = 'block';

                fetch('/spring/proveedores/filtrar/' + rubro)
                    .then(res => res.json())
                    .then(data => {
                        // Reemplazar el contenido
                        setTimeout(() => {
                            contenedor.innerHTML = '';

                            if (data.length === 0) {
                                contenedor.innerHTML = '<p class="text-muted">No hay proveedores disponibles en este rubro.</p>';
                            } else {
                                data.forEach(p => {
                                    contenedor.innerHTML += `
                <div class="text-center proveedor-card">
                  <img src="/spring/${p.logoPath}" class="img-fluid rounded" style="width:120px; height:auto; object-fit:contain;">
                  <p class="mt-2">${p.razonSocial}</p>
                </div>`;
                                });
                            }

                            // Ocultar loader y mostrar contenido con efecto
                            loader.style.display = 'none';
                            setTimeout(() => contenedor.classList.add('show'), 100);
                        }, 500);
                    })
                    .catch(err => {
                        loader.style.display = 'none';
                        contenedor.innerHTML = '<p class="text-danger">Error al cargar proveedores.</p>';
                    });
            });
        });

        //

    </script>

</body>

</html>