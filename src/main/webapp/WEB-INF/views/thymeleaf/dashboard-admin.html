<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administrador</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.8/spacelab/bootstrap.min.css"
        integrity="sha512-d6bs4euKJygnskFpAbuXvKmH36SBZ7wKshGKyDcS3POzWAm4inqIqTLZTU+AxRWWfkFmMNMbzHoi4AzKoayLew=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/dashboard-admin.css}">

    <!-- Scripts iniciales -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        window.dashboardData = {
            usuarios: /*[[${usuariosJson}]]*/,
            totalClientes: /*[[${totalClientes}]]*/,
            totalProveedores: /*[[${totalProveedores}]]*/,
            totalUsuarios: /*[[${totalUsuarios}]]*/
        };
        /*]]>*/
    </script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script th:src="@{/js/dashboard-admin.js}" defer></script>
</head>

<body>
    <div class="d-flex vh-100">
        <div th:replace="sidebar-admin :: sidebar"></div>
    
    <main class="flex-grow-1 p-4 overflow-auto">
        <div class="stats d-flex">
            <div class="content">
                <div class="stats d-flex gap-4 mb-4 flex-wrap">
                    <div class="stat flex-fill text-center" data-filter="USUARIOS_TODOS">
                        <span class="number" th:text="${totalUsuarios}">0</span><br>
                        <span class="label">Total de Usuarios</span>
                    </div>
                    <div class="stat flex-fill text-center" data-filter="PROVEEDORES_TODOS">
                        <span class="number" th:text="${totalProveedores}">0</span><br>
                        <span class="label">Total de Proveedores</span>
                    </div>
                    <div class="stat flex-fill text-center" data-filter="CLIENTES_TODOS">
                        <span class="number" th:text="${totalClientes}">0</span><br>
                        <span class="label">Total Clientes</span>
                    </div>
                    <div class="stat flex-fill text-center" data-filter="PENDIENTE">
                        <span class="number" th:text="${proveedoresPendientes}">0</span><br>
                        <span class="label">Proveedores Pendientes</span>
                    </div>
                    <div class="stat flex-fill text-center" data-filter="RECHAZADO">
                        <span class="number" th:text="${proveedoresRechazados}">0</span><br>
                        <span class="label">Proveedores Rechazados</span>
                    </div>
                </div>
            </div>
        </div>

        <section id="pdf-content" class="dashboard">
            <section class="dashboard-container">
                <div id="grafico_usuarios" class="card"></div>
        </section>
        
        <div class="mb-3">
            <input type="text" id="buscarUsuario" class="form-control"
            placeholder="Escribe aqui para buscar por usuario, email, razon social...">
        </div>
        
        <div class="events-table">
            <table class="table table-striped" id="tablaUsuarios">
                <thead>
                    <tr>
                        <th data-col="0" class="sortable">ID</th>
                        <th data-col="1" class="sortable">Usuario</th>
                        <th data-col="2" class="sortable">Email</th>
                        <th data-col="3" class="sortable">CUIT</th>
                        <th data-col="4" class="sortable">Rubro</th>
                        <th data-col="5" class="sortable">Rol</th>
                        <th data-col="6" class="sortable">Estado</th>
                        <th data-col="7" class="sortable">Fecha Registro</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="u : ${usuarios}" 
                    th:classappend="${u.estado == 'PENDIENTE'} ? 'fila-clickable' : ''">
                        <td th:text="${u.id}"></td>
                        <td th:text="${u.nombreMostrable}"></td>
                        <td th:text="${u.email}"></td>
                        <td th:text="${u.cuit}"></td>
                        <td th:text="${u.rubro != null ? u.rubro.descripcion : '-'}"></td>
                        <td th:text="${u.rol}"></td>
                        <td th:text="${u.estado.descripcion}"></td>
                        <td th:text="${@fechaUtil.formatear(u.fechaCreacion)}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

        <a th:href="@{/admin/usuarios/exportar-excel}" class="btn btn-primary">Exportar Excel</a>
        <button id="btnExportarPDF" class="btn btn-dark">Exportar PDF</button>
    </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="text/javascript" th:src="@{/webjars/bootstrap/5.2.0/js/bootstrap.bundle.min.js}"></script>
</body>
</html>