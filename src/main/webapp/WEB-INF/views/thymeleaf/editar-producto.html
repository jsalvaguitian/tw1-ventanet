<!DOCTYPE HTML>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Taller Web I</title>

  <!-- Bootstrap core css -->
  <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}" />

  <!-- custom style -->
  <link rel="stylesheet" th:href="@{/css/producto.css}" />
</head>

<body>
  <header>
    <!-- Logo -->
    <a href="#" class="navbar-brand">Ventanet</a>

    <!-- Menú derecho -->
    <ul class="nav">
      <!-- Campana de notificaciones con dropdown -->
      <li class="nav-item dropdown me-3">
        <a class="nav-link position-relative" href="#" id="notificationsDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-bell fs-5"></i>
          <span class="badge rounded-pill">3</span>
        </a>

        <!-- Dropdown de notificaciones -->
        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="notificationsDropdown"
          style="width: 470px;">
          <li class="dropdown-item d-flex align-items-start">
            <i class="bi bi-bell me-2 text-secondary"></i>
            <span>Tienes 3 nuevas solicitudes de cotización pendientes</span>
          </li>
          <li class="dropdown-item d-flex align-items-start">
            <i class="bi bi-bell me-2 text-secondary"></i>
            <span>Tu cotización #145 fue aceptada</span>
          </li>
          <li class="dropdown-item d-flex align-items-start">
            <i class="bi bi-bell me-2 text-secondary"></i>
            <span>El valor del dólar se actualizó a 83,9</span>
          </li>
          <li class="dropdown-item d-flex align-items-start">
            <i class="bi bi-bell me-2 text-secondary"></i>
            <span>Error en la importación: 2 productos no se cargaron correctamente</span>
          </li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li>
            <a class="dropdown-item text-center text-primary fw-bold" href="#">Ver todas</a>
          </li>
        </ul>
      </li>

      <!-- Usuario con dropdown -->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false">
          <img src="https://via.placeholder.com/30" class="rounded-circle me-2" alt="User">
          <span th:text="${mailProveedor}">Proveedor</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
          <li><a class="dropdown-item" href="#">Perfil</a></li>
          <li><a class="dropdown-item" href="#">Configuración</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li>
            <form th:action="@{/logout}" method="get" class="m-0">
              <button type="submit" class="dropdown-item">Cerrar sesión</button>
            </form>
          </li>
        </ul>
      </li>
    </ul>
  </header>
  <main role="main" class="container">

    <div class="main-container">
      <div th:replace="sidebar :: sidebar"></div>
      <main>
        <div class="form-card">
          <form action="#" th:action="@{/producto/editar/{id}(id=${producto.id})}" method="POST" th:object="${producto}"
            enctype="multipart/form-data">
            <h3>Edición de Producto</h3>

            <!-- Nombre -->
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre</label>
              <input th:field="*{nombre}" id="nombre" class="form-control" required />
            </div>

            <!-- Precio -->
            <div class="mb-3">
              <label for="precio" class="form-label">Precio</label>
              <input th:field="*{precio}" id="precio" type="number" step="0.01" min="0" class="form-control" required />
            </div>

            <!-- Descripción -->
            <div class="mb-3">
              <label for="descripcion" class="form-label">Descripción</label>
              <textarea th:field="*{descripcion}" id="descripcion" class="form-control" rows="3"></textarea>
            </div>

            <!-- Imagen (archivo) -->
            <div class="mb-3">
              <label for="imagenFile" class="form-label">Imagen del Producto</label>
              <input id="imagenFile" name="imagenFile" type="file" class="form-control" accept="image/*" />
            </div>

            <!-- Stock -->
            <div class="mb-3">
              <label for="stock" class="form-label">Stock</label>
              <input th:field="*{stock}" id="stock" type="number" min="0" class="form-control" required />
            </div>

            <!-- Tipo de Producto -->
            <div class="mb-3">
              <label for="tipo_producto_id" class="form-label">Tipo de Producto</label>
              <select th:field="*{tipoProducto.id}" id="tipo_producto_id" class="form-select">
                <option value="">Seleccione...</option>v
                <option th:each="tipo : ${tiposProducto}" th:value="${tipo.id}" th:text="${tipo.nombre}"></option>
              </select>
            </div>

            <!-- Marca -->
            <div class="mb-3">
              <label for="marca_id" class="form-label">Marca</label>
              <select th:field="*{marca.id}" id="marca_id" class="form-select">
                <option value="">Seleccione...</option>
                <option th:each="marca : ${marcas}" th:value="${marca.id}" th:text="${marca.nombre}"></option>
              </select>
            </div>

            <!-- Presentación -->
            <div class="mb-3">
              <label for="presentacion_id" class="form-label">Presentación</label>
              <select th:field="*{presentacion.id}" id="presentacion_id" class="form-select">
                <option value="">Seleccione...</option>
                <option th:each="pres : ${presentaciones}" th:value="${pres.id}" th:text="${pres.descripcion}"></option>
              </select>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-between">
              <button id="btn-edit" class="btn btn-submit" type="submit">Guardar Cambios</button>
            </div>

            <!-- Mensajes de error -->
            <p th:if="${error != null}" class="alert alert-danger mt-3" th:text="'Error: ' + ${error}"></p>
          </form>
        </div>
      </main>

    </div>



  </main>

  <!-- Bootstrap core js -->
  <!-- <script type="text/javascript" th:src="@{/webjars/bootstrap/5.2.0/js/bootstrap.min.js}"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Producto JS -->
  <script type="module" th:src="@{/js/producto.js}"></script>
  <script>
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("collapsed");
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script th:inline="javascript">
/*<![CDATA[*/
  // Thymeleaf reemplaza esto por un literal JS:
  // - si exito tiene valor -> "El producto..." (con comillas)
  // - si exito es null -> null (literal JS)
  const mensajeExito = /*[[${exito}]]*/ null;
  const mensajeError  = /*[[${error}]]*/ null;

  if (mensajeExito) {
    Swal.fire({
      icon: 'success',
      title: '¡Éxito!',
      text: mensajeExito,
      showConfirmButton: false,
      timer: 2000,
      timerProgressBar: true
    }).then(() => {     
      window.location.href = /*[[@{/producto/listado}]]*/ '/producto/listado';
    });
  }

  if (mensajeError) {
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: mensajeError,
      confirmButtonText: 'Entendido'
    });
  }
/*]]>*/
</script>


</body>

</html>